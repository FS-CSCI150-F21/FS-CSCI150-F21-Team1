<!DOCTYPE html>
<meta charset="UTF-8">
<html>

<head>
    <!-- create css page for when you export internal css to external
            and update this link.
            <link rel="stylesheet" type="text/css" href="../css_pages/">-->
    <title id='title'>
        Menu: Categories
    </title>
    <style>
        /*
        *{
            margin: 0;
            padding: 0;
        }
        */

        html {
            /*background-color: #000a0b;*/
            color: #055f60;
        }

        body {
            margin: 0 0;
        }

        /*
        h1,
        h2 {
            text-align: left;
        }
        */
        #h1Title {
            display: none;
        }

        h1 {
            margin: 1vh 0 1vh 5vw;
        }

        #catTbl caption,
        table thead {
            display: none;
        }

        #catTbl {
            /*margin: auto auto;*/
            border-collapse: collapse;
            /*display: grid;*/
            text-align: left;
        }

        td.catName {
            background-color: white;
            text-align: center;
        }

        /*
        td.catName:hover{
            background-color: black;
        }
        */

        td.odd {
            background-color: white;
        }

        #catTbl td {
            padding: 0 0;
            margin: 0 0;
            width: 11vw;
        }

        #catTbl tr {
            margin: 0 0;
            padding: 0 0;
            display: inline-block;
            opacity: 1;
        }

        #catTbl tr:active {
            opacity: .5;
        }

        img {
            margin: 0;
            padding: 0;
            object-fit: cover;
            display: block;
        }

        /*After category is chosen*/

        /*nav menu on left, after a category is chosen.*/
        nav {
            margin: 0 0 1vh 0;
        }

        nav ul {
            list-style-type: none;
            margin: 0 0 0 0;
            padding: 0;
            color: white;
            text-align: center;
        }

        nav ul li {
            padding: 1vh 1vw;
            background-color: #055f60;
            display: inline-block;
        }

        nav ul li:hover {
            opacity: .5;
        }

        #selectedNavItem {
            color: black;
        }

        #selectedNavItem:hover {
            opacity: 1;
        }

        /*subcategories*/
        table.subcategory {

            text-align: left;
            border-collapse: collapse;
            margin: 3vh auto;
        }

        .subcategory td {
            padding: 0 1vw;
            vertical-align: top;
        }

        table.subcategory caption {
            font-size: 150%;
        }

        td.itemName {
            font-weight: bold;
            vertical-align: top;
            text-align: left;
            width: 25%;
        }

        td.itemDescription {
            text-align: center;
        }

        td.itemPrice {
            text-align: right;
        }
    </style>
    <script>
        //used on load to show the main categories of the menu.
        //this data is grabbed from the mysql database.  see menu.php file.
        function categories() {
            let httpRequest = new XMLHttpRequest();
            httpRequest.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    let responseObj = JSON.parse(httpRequest.responseText);
                    let catBod = document.getElementById('catTblBod');
                    for (let i = 0; i < responseObj.length; i++) {
                        //only populate category if marked as "available"
                        if (responseObj[i][2] == true) {

                            //table row
                            let tr = document.createElement('tr');
                            tr.onclick = function () { firstCategoryChange(i) };

                            //table row cell
                            let td = document.createElement('td');
                            td.innerText = responseObj[i][0];
                            td.className = 'catName';

                            /*
                            //may not odd vs even anymore.  was for css.
                            colorClass = (i % 2) ? "odd" : "even";
                            td.className = 'catName + ' + colorClass;
                            */

                            //add category name table cell to table row element
                            tr.appendChild(td);

                            //new table cell element to house image.
                            td = document.createElement('td');
                            td.className = 'imgCell';
                            let img = document.createElement('img');
                            img.src = "../images/menu/" + responseObj[i][3];
                            img.width = "350";
                            img.height = "300";
                            //img.width = "50";
                            //img.height = "50";

                            //append image to table cell, table cell to table row,
                            //and table row to table body.
                            td.appendChild(img);
                            tr.appendChild(td);
                            catBod.appendChild(tr);
                        }
                    }
                }
            }
            httpRequest.open("GET", "../php_pages/menu.php?request=cats", true);
            httpRequest.send();
        }
        function firstCategoryChange(i) {
            alertMessage = 'This function will be replaced with an AJAX method to dynamically'
                + ' change the webpage based on the category (' + i + ') chosen.';
            //alert(alertMessage);

            /*
            //remove all the images
            let imgCells = document.getElementsByClassName('imgCell');
            while(imgCells[0]!=undefined){
                imgCells[0].remove();
            }
            */
            let nav = document.createElement('nav');
            let catNames = document.getElementsByClassName('catName');

            let ul = document.createElement('ul');
            for (let i = 0; i < catNames.length; i++) {
                let li = document.createElement('li');
                li.innerText = catNames[i].innerText;
                li.onclick = function () { catChange(i) };
                ul.appendChild(li);
            }

            //alert(ul.children[i].innerText);
            ul.children[i].id = 'selectedNavItem';
            let selectedCategoryText = ul.children[i].innerText;
            document.getElementById('h1Title').innerText = selectedCategoryText;
            document.getElementById('title').innerText = 'Menu: ' + selectedCategoryText;

            //append unordered list to navigation bar, and nav bar to document body
            nav.appendChild(ul)
            document.body.appendChild(nav);

            //remove categories table
            document.getElementById('catTbl').remove();

            //access database through php page to get selected category's information
            let httpRequest = new XMLHttpRequest();
            if (!httpRequest) {
                alert('Cannot create an XMLHTTP instance');
                return false;
            }
            httpRequest.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    if (httpRequest.responseText) {
                        //populate main window with category's items/details
                        categoryDisplay(httpRequest.responseText, i);
                        //console.log('onreadystatechange function');
                        //console.log('readyState: ' + this.readyState);
                        //console.log('status: ' + this.status);
                    }

                }
            }
            httpRequest.open("GET", "../php_pages/menu.php?request=" + i, true);
            httpRequest.send();
        }
        function catChange(i) {
            let subcatTbls = document.getElementsByClassName('subcategory');
            while (subcatTbls[0]) {
                subcatTbls[0].remove();
            }
            //alert(i);
            let httpRequest = new XMLHttpRequest();
            if (!httpRequest) {
                alert('Cannot create XMLHttpRequest instance');
                return false;
            }
            httpRequest.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    categoryDisplay(httpRequest.responseText,i);
                }
            }
            httpRequest.open("GET","../php_pages/menu.php?request="+i);
            httpRequest.send();
        }

        function categoryDisplay(jsonStr, catIndex) {
            let subcatTbls = document.getElementsByClassName('subcategory');
            while (subcatTbls[0]) {
                subcatTbls[0].remove();
            }
            //console.log(jsonStr);
            let subcatsArr = JSON.parse(jsonStr);
            //console.log(subcatsArr);
            //console.log(Object.keys(respObj));
            //let subCats = Object.keys(respObj);

            //experiment to hold all subcategories and use css grid.
            let subcategoriesTable = document.createElement('table');
            for (let i = 0; i < subcatsArr.length; i++) {

                let subcat = subcatsArr[i];//object of array
                //console.log(subcat);
                //console.log(subcat["name"]);

                let tbl = document.createElement('table');
                tbl.className = 'subcategory';
                let caption = document.createElement('caption');
                caption.innerText = subcat["name"];
                tbl.appendChild(caption);


                //thead contains column headers.  will be hidden in css.
                let thead = document.createElement('thead');
                let tr = document.createElement('tr');
                let th = document.createElement('th');
                th.innerText = "Name";
                tr.appendChild(th);
                th = document.createElement('th');
                th.innerText = "Description";
                tr.appendChild(th);  //consider id cell, too
                th = document.createElement('th');
                th.innerText = "Price";
                tr.appendChild(th);
                thead.appendChild(tr);
                tbl.appendChild(thead);


                //table items
                let items = subcat["items"]; //array of items from subcategory
                //console.log(items[0]);
                let tbody = document.createElement('tbody');
                for (let j = 0; j < items.length; j++) {
                    //let itemTbl = document.createElement('table');
                    tr = document.createElement('tr');

                    //item name
                    let td = document.createElement('td');
                    td.innerText = items[j]['name'];
                    td.className = "itemName";
                    tr.appendChild(td);

                    //item description
                    td = document.createElement('td');
                    td.innerText = items[j]['description'];
                    td.className = 'itemDescription';
                    tr.appendChild(td);

                    //item price
                    td = document.createElement('td');
                    td.innerText = items[j]['price'];
                    td.className = 'itemPrice';
                    tr.appendChild(td);
                    /*
                    for (let k = 0; k < items[j].length; k++) {
                        let td = document.createElement('td');
                        td.innerText = items[j][k];
                        tr.appendChild(td);
                    }
                    */
                    tbody.appendChild(tr);
                }

                tbl.appendChild(tbody);
                document.body.appendChild(tbl);
            }


        }
    </script>
</head>

<body onload='categories()'>
    <h1 id='h1Title'>Menu</h1>
    <!-- This page should load categories of the menu, which would be acquired
        from the database. Examples are drinks, appetizers, soups & salads,
        kid's meals, entrees, and desserts.
    -->
    <!--
    <p>
        Once a category is chosen, a side bar will appear on the left with a
        smaller version of all these category choices.  "Menu" above will change to
        category name.
    </p>
-->

    <table id='catTbl'>
        <caption>Categories</caption>
        <thead>
            <th>Category</th>
            <th>Image</th>
        </thead>
        <tbody id='catTblBod'></tbody>
    </table>
</body>

</html>